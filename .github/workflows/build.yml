name: Infinity-X Build gta4l
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: Freeing up disk space
        uses: easimon/maximize-build-space@main
        with:
          root-reserve-mb: 512
          swap-size-mb: 1024
          remove-dotnet: 'true'
          remove-android: 'true'
          remove-haskell: 'true'
          remove-codeql: 'true'
          remove-docker-images: 'true'

      - name: Set up Environment
        run: |
          sudo apt update
          sudo apt install bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev -y
          mkdir ~/bin
          curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
          chmod a+x ~/bin/repo
          sudo ln -sf ~/bin/repo /usr/bin/repo

      - name: Sync and Build
        run: |
          git config --global user.email "tabmohamedpro@gmail.com"
          git config --global user.name "Mkpromypro"
          
          mkdir build && cd build
          repo init -u https://github.com/ProjectInfinity-X/manifest -b 15 --depth=1
          
          mkdir -p .repo/local_manifests
          echo '<?xml version="1.0" encoding="UTF-8"?>
          <manifest>
            <project name="LineageOS/android_device_samsung_gta4l" path="device/samsung/gta4l" remote="github" revision="lineage-22.1" />
            <project name="LineageOS/android_device_samsung_gta4l-common" path="device/samsung/gta4l-common" remote="github" revision="lineage-22.1" />
            <project name="LineageOS/android_kernel_samsung_sm6115" path="kernel/samsung/sm6115" remote="github" revision="lineage-22.1" />
            <project name="TheMuppets/proprietary_vendor_samsung_gta4l" path="vendor/samsung/gta4l" remote="github" revision="lineage-22.1" />
            <project name="TheMuppets/proprietary_vendor_samsung_gta4l-common" path="vendor/samsung/gta4l-common" remote="github" revision="lineage-22.1" />
          </manifest>' > .repo/local_manifests/gta4l.xml
          
          # أمر الـ Sync ده هو اللي هيوفر المساحة
          repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j$(nproc --all)
          
          source build/envsetup.sh
          lunch infinity_gta4l-ap3a-userdebug
          mka bacon
